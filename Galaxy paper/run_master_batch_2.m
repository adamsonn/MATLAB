
clearvars
clc

sdir   = 'C:\Users\Suki''s Lab\Desktop\DATA\lung_imaging\scans\' ;
svfldr = 'C:\Users\Suki''s Lab\Desktop\DATA\lung_imaging\lung_structs\' ;

emph_all  = { -960 } ; % { -910, -930, -950, -960, -990 } ;

% batch_pt = { ...
%     'KIT0011', [ .644 .644 .500 ] ; ...
%     'KIT0032', [ .628 .628 .500 ] ; ...
%     'KIT0034', [ .695 .695 .500 ] ; ...
%     'KIT0062', [ .689 .689 .500 ] ; ...
%     'KIT0064', [ .662 .662 .500 ] ; ...
%     'KIT0066', [ .711 .711 .500 ] ; ...
%     'KIT0092', [ .698 .698 .500 ] ; ...
%     'KIT0141', [ .625 .625 .500 ] ; ...
%     'KIT0144', [ .625 .625 .500 ] ; ...
%     'KIT0145', [ .677 .677 .500 ] ; ...
%     'KIT0205', [ .717 .717 .500 ] ; ...
%     'KIT0212', [ .665 .665 .500 ] ; ...
%     'KIT0437', [ .625 .625 .500 ] ; ...
%     'KIT0438', [ .843 .843 .500 ] ; ...
%     } ;

batch_pt = { ...
    %'MD0006', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    'MD0008', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0011', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0018', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    'MD0020', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0023', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0029', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0136', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0045', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0119', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    %'MD0150', [ .741 .741 .500 ; .741 .741 .500 ; .738 .738 .500 ] ; ...
    %'MD0163', [ .683 .683 .500 ; .683 .683 .500 ; .683 .683 .500 ] ; ...
    } ;

for nn = 1:length( emph_all )
    tmp     = [ num2str( emph_all{ nn } ) 'HU' ] ;  disp( tmp )
    svdir   = fullfile( svfldr, tmp ) ;
    emph_th = emph_all{ nn } ;
    
    for ii = 1:size( batch_pt,1 )
        pt_names = dir( fullfile( sdir, [ batch_pt{ ii,1 } '*.mat' ] ) ) ;
        pt_names = { pt_names.name } ;
        
        for jj = 1:length( pt_names )
            fn  = pt_names{ jj } ;
            vsz = batch_pt{ ii,2 }( jj,: ) ;
            
            run_master_single
            
            disp( [ pt_names{jj} '  ' datestr(now) ] )
            
            clearvars -except sdir svfldr svdir emph_all emph_th batch_pt pt_names nn ii jj
        end
    end
end
